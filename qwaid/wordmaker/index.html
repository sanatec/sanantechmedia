<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>اردو ورڈ میکر گیم</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap');
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      font-family: 'Noto Nastaliq Urdu', serif;
      overflow-x: hidden;
    }
    
    body {
      background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 50%, #FECFEF 100%);
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      min-height: 85vh;
      position: relative;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* Floating decorative elements */
    .decoration {
      position: absolute;
      pointer-events: none;
      opacity: 0.3;
      animation: float 6s ease-in-out infinite;
    }
    
    .decoration:nth-child(1) {
      top: 10%;
      left: 10%;
      font-size: 40px;
      animation-delay: 0s;
    }
    
    .decoration:nth-child(2) {
      top: 20%;
      right: 15%;
      font-size: 35px;
      animation-delay: 2s;
    }
    
    .decoration:nth-child(3) {
      bottom: 15%;
      left: 20%;
      font-size: 30px;
      animation-delay: 4s;
    }
    
    .decoration:nth-child(4) {
      bottom: 25%;
      right: 10%;
      font-size: 45px;
      animation-delay: 1s;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }
    
    .game-container {
      width: 100%;
      max-width: 800px;
      background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
      border-radius: 25px;
      padding: 25px;
      box-shadow: 
        0 20px 40px rgba(0,0,0,0.1),
        0 0 0 3px #FFD700,
        inset 0 0 20px rgba(255,215,0,0.1);
      position: relative;
      z-index: 10;
      border: 5px solid transparent;
      background-clip: padding-box;
    }
    
    .game-container::before {
      content: '';
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4, #FFEAA7);
      border-radius: 30px;
      z-index: -1;
      animation: borderGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes borderGlow {
      0% { opacity: 0.5; transform: scale(1); }
      100% { opacity: 1; transform: scale(1.01); }
    }
    
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 20px;
      border-radius: 20px;
      font-size: clamp(20px, 5vw, 28px);
      font-weight: 700;
      text-align: center;
      margin-bottom: 20px;
      font-family: 'Noto Nastaliq Urdu', serif;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shine 2s infinite;
    }
    
    @keyframes shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    .level-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
      padding: 15px;
      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      border-radius: 20px;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .level-btn {
      padding: 12px 18px;
      border-radius: 15px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      color: white;
      font-weight: 700;
      font-size: clamp(12px, 2.5vw, 16px);
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-family: 'Noto Nastaliq Urdu', serif;
      min-width: 90px;
      box-shadow: 0 4px 15px rgba(116, 185, 255, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .level-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transition: all 0.3s ease;
      transform: translate(-50%, -50%);
    }
    
    .level-btn:hover::before {
      width: 100%;
      height: 100%;
    }
    
    .level-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(116, 185, 255, 0.6);
    }
    
    .level-btn.active {
      background: linear-gradient(135deg, #fd79a8, #e84393);
      box-shadow: 0 8px 25px rgba(253, 121, 168, 0.5);
      transform: scale(1.1);
    }
    
    .level-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding: 15px 20px;
      background: linear-gradient(135deg, #a29bfe, #6c5ce7);
      color: #fff;
      border-radius: 15px;
      font-weight: 700;
      font-size: clamp(14px, 3vw, 18px);
      font-family: 'Noto Nastaliq Urdu', serif;
      flex-wrap: wrap;
      gap: 10px;
      box-shadow: 0 6px 20px rgba(108, 92, 231, 0.3);
    }
    
    .question-container {
      display: flex;
      justify-content: center;
      margin-bottom: 25px;
    }
    
    .question {
      font-size: clamp(28px, 7vw, 42px);
      padding: 25px 30px;
      border-radius: 20px;
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      border: 4px solid #ff7675;
      color: #2d3436;
      box-shadow: 
        0 10px 30px rgba(0,0,0,0.15),
        inset 0 1px 0 rgba(255,255,255,0.3);
      min-width: 220px;
      text-align: center;
      font-family: 'Noto Nastaliq Urdu', serif;
      font-weight: 800;
      position: relative;
      animation: questionPulse 2s ease-in-out infinite;
    }
    
    @keyframes questionPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    .options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 25px;
    }
    
    .option {
      padding: 20px;
      border-radius: 18px;
      border: none;
      font-size: clamp(20px, 4.5vw, 28px);
      background: linear-gradient(135deg, #fd79a8, #fdcb6e);
      cursor: pointer;
      font-weight: 800;
      box-shadow: 0 8px 20px rgba(253, 121, 168, 0.3);
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-family: 'Noto Nastaliq Urdu', serif;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #fff;
      position: relative;
      overflow: hidden;
    }
    
    .option::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }
    
    .option:hover::before {
      left: 100%;
    }
    
    .option:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 15px 35px rgba(253, 121, 168, 0.4);
    }
    
    .option:active {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 5px 15px rgba(253, 121, 168, 0.3);
    }
    
    .option:nth-child(1) { background: linear-gradient(135deg, #74b9ff, #0984e3); }
    .option:nth-child(2) { background: linear-gradient(135deg, #fd79a8, #e84393); }
    .option:nth-child(3) { background: linear-gradient(135deg, #fdcb6e, #e17055); }
    .option:nth-child(4) { background: linear-gradient(135deg, #6c5ce7, #a29bfe); }
    
    .feedback {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 300;
      background: linear-gradient(135deg, #ff7675, #fd79a8);
      color: white;
      padding: 25px 40px;
      border-radius: 20px;
      font-size: clamp(22px, 5vw, 36px);
      font-weight: 800;
      box-shadow: 0 20px 40px rgba(255, 118, 117, 0.4);
      display: none;
      border: 4px solid #ffffff;
      font-family: 'Noto Nastaliq Urdu', serif;
      text-align: center;
      max-width: 90vw;
      animation: feedbackBounce 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    @keyframes feedbackBounce {
      0% { transform: translate(-50%, -50%) scale(0); }
      50% { transform: translate(-50%, -50%) scale(1.1); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    
    canvas#star-canvas {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 200;
    }
    
    /* Success animation overlay */
    .success-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(116,185,255,0.3) 0%, transparent 70%);
      pointer-events: none;
      z-index: 250;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .success-overlay.active {
      opacity: 1;
    }
    
    /* Mobile responsive adjustments */
    @media (max-width: 768px) {
      .game-container {
        margin: 5px;
        padding: 18px;
        border-radius: 20px;
      }
      
      .level-selector {
        gap: 8px;
        padding: 12px;
      }
      
      .level-btn {
        padding: 10px 14px;
        min-width: 75px;
      }
      
      .level-info {
        flex-direction: column;
        text-align: center;
        gap: 8px;
        padding: 12px 16px;
      }
      
      .options {
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      
      .question {
        padding: 18px 20px;
        min-width: 180px;
      }
      
      .option {
        padding: 16px;
        min-height: 70px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 5px;
      }
      
      .game-container {
        padding: 12px;
        border-radius: 15px;
        max-height: 90vh;
        overflow-y: auto;
      }
      
      header {
        padding: 10px;
        margin-bottom: 10px;
      }
      
      .level-selector {
        gap: 4px;
        padding: 8px;
        margin-bottom: 10px;
      }
      
      .level-btn {
        padding: 6px 10px;
        min-width: 60px;
        font-size: 11px;
      }
      
      .level-info {
        padding: 8px 10px;
        margin-bottom: 12px;
      }
      
      .question-container {
        margin-bottom: 12px;
      }
      
      .question {
        padding: 12px 15px;
        margin-bottom: 0;
      }
      
      .options {
        grid-template-columns: 1fr;
        gap: 8px;
        margin-top: 12px;
      }
      
      .option {
        padding: 12px;
        min-height: 50px;
      }
      
      .feedback {
        padding: 15px 25px;
        max-width: 95vw;
      }
      
      .decoration {
        display: none;
      }
    }
    
    @media (max-width: 320px) {
      .level-selector {
        flex-direction: column;
        align-items: center;
      }
      
      .level-btn {
        width: 100%;
        max-width: 200px;
      }
    }
    
    /* Ensure proper font rendering for all Urdu text elements */
    .question, .option, .feedback, .level-info, header, .level-btn {
      font-feature-settings: "liga" 1, "kern" 1;
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* High DPI display adjustments */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .question, .option, .feedback, .level-info, header {
        -webkit-font-smoothing: subpixel-antialiased;
      }
    }
    
    /* Prevent text selection on game elements */
    .level-btn, .option, .question {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <!-- Floating decorative elements -->
  <div class="decoration">🌟</div>
  <div class="decoration">⭐</div>
  <div class="decoration">🎈</div>
  <div class="decoration">🦋</div>

  <div class="game-container" role="application" aria-label="Urdu word maker game">
    <header>✨ Word Maker Game ✨</header>

    <div class="level-selector" id="level-selector">
      <button class="level-btn level1 active" onclick="changeLevel(0)">Level 1</button>
      <button class="level-btn level2" onclick="changeLevel(1)">Level 2</button>
      <button class="level-btn level3" onclick="changeLevel(2)">Level 3</button>
      <button class="level-btn level4" onclick="changeLevel(3)">Level 4</button>
      <button class="level-btn level5" onclick="changeLevel(4)">Level 5</button>
    </div>

    <div class="level-info">
      <div id="level-display">Level 1 - بنیادی حروف</div>
      <div>Score: <span id="score">0</span> 🏆</div>
    </div>

    <div class="question-container">
      <div class="question" id="question">---</div>
    </div>

    <div class="options" id="options" role="list"></div>

    <div class="feedback" id="feedback" role="status" aria-live="polite"></div>
    <div class="success-overlay" id="success-overlay"></div>
  </div>

  <canvas id="star-canvas" aria-hidden="true"></canvas>

  <script>
    // ---------- Enhanced Fireworks ----------
    const canvas = document.getElementById('star-canvas');
    const ctx = canvas.getContext('2d');
    const successOverlay = document.getElementById('success-overlay');

    function resizeCanvas(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function launchFireworks() {
      // Show success overlay
      successOverlay.classList.add('active');
      setTimeout(() => {
        successOverlay.classList.remove('active');
      }, 1000);

      const particles = [];
      const colors = ["#FFD700", "#FF6B6B", "#4ECDC4", "#45B7D1", "#96CEB4", "#FFEAA7", "#fd79a8", "#74b9ff"];

      // Create multiple explosion centers
      const centers = [
        { x: canvas.width * 0.3, y: canvas.height * 0.4 },
        { x: canvas.width * 0.7, y: canvas.height * 0.4 },
        { x: canvas.width * 0.5, y: canvas.height * 0.6 }
      ];

      centers.forEach(center => {
        for (let i = 0; i < 25; i++) {
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 8 + 4;
          particles.push({
            x: center.x,
            y: center.y,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed - 3,
            size: Math.random() * 6 + 3,
            color: colors[Math.floor(Math.random() * colors.length)],
            life: 120,
            maxLife: 120
          });
        }
      });

      function drawStar(x, y, size, color, alpha) {
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.beginPath();
        ctx.translate(x, y);
        ctx.moveTo(0, -size);
        for (let i = 0; i < 5; i++) {
          ctx.rotate(Math.PI / 5);
          ctx.lineTo(0, -size * 0.5);
          ctx.rotate(Math.PI / 5);
          ctx.lineTo(0, -size);
        }
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.shadowColor = color;
        ctx.shadowBlur = 20;
        ctx.fill();
        ctx.restore();
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.1; // gravity
          p.vx *= 0.99; // air resistance
          p.life--;
          
          if (p.life > 0) {
            const alpha = p.life / p.maxLife;
            drawStar(p.x, p.y, p.size * alpha, p.color, alpha);
          } else {
            particles.splice(i, 1);
          }
        });
        
        if (particles.length > 0) {
          requestAnimationFrame(animate);
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      }
      animate();
    }

    // ---------- Levels data ----------
    const levels = [
      {
        name: "Level 1 - بنیادی حروف",
        puzzles: [
          { q: "ک + ا = ؟", answer: "کا", choices: ["کی","کا","کو","کہ"], audio: "ka.wav" },
          { q: "ب + ی = ؟", answer: "بی", choices: ["بو","بی","با","بے"], audio: "bi.wav" },
          { q: "ت + و = ؟", answer: "تو", choices: ["تی","تا","تو","تہ"], audio: "to.wav" },
          { q: "ا + ا = ؟", answer: "آ", choices:  ["آ","او","ای","ئے"], audio: "aa.wav" },
          { q: "ک + ے = ؟", answer: "کے", choices: ["کے","کو","کی","کا"], audio: "ke.wav" },
          { q: "ر + ا = ؟", answer: "را", choices: ["رے","رو","ری","را"], audio: "ra.wav" },
          { q: "پ + ا = ؟", answer: "پا", choices: ["پے","پو","پی","پا"], audio: "pa.wav" },
          { q: "پ + ی = ؟", answer: "پی", choices: ["پے","پو","پی","پا"], audio: "pi.wav" },
          { q: "پ + و = ؟", answer: "پو", choices: ["پے","پو","پی","پا"], audio: "po.wav" },
          { q: "پ + ے = ؟", answer: "پے", choices: ["پے","پو","پی","پا"], audio: "pe.wav" },
          { q: "ٹ + ا = ؟", answer: "ٹا", choices: ["ٹے","ٹو","ٹی","ٹا"], audio: "ta.wav" },
          { q: "ٹ + ی = ؟", answer: "ٹی", choices: ["ٹے","ٹو","ٹی","ٹا"], audio: "ti.wav" },
          { q: "ٹ + و = ؟", answer: "ٹو", choices: ["ٹے","ٹو","ٹی","ٹا"], audio: "tto.wav" },
          { q: "ٹ + ے = ؟", answer: "ٹے", choices: ["ٹے","ٹو","ٹی","ٹا"], audio: "te.wav" },
          { q: "چ + ا = ؟", answer: "چا", choices: ["چے","چو","چی","چا"], audio: "cha.wav" },
          { q: "چ + ی = ؟", answer: "چی", choices: ["چے","چو","چی","چا"], audio: "chi.wav" },
          { q: "چ + و = ؟", answer: "چو", choices: ["چے","چو","چی","چا"], audio: "chu.wav" },
          { q: "چ + ے = ؟", answer: "چے", choices: ["چے","چو","چی","چا"], audio: "che.wav" },
          { q: "س + ا = ؟", answer: "سا", choices: ["سے","سو","سی","سا"], audio: "sa.wav" },
          { q: "س + ی = ؟", answer: "سی", choices: ["سے","سو","سی","سا"], audio: "si.wav" },
          { q: "س + و = ؟", answer: "سو", choices: ["سے","سو","سی","سا"], audio: "su.wav" },
          { q: "س + ے = ؟", answer: "سے", choices: ["سے","سو","سی","سا"], audio: "se.wav" },
          { q: "ل + ا = ؟", answer: "لا", choices:  ["لے","لو","لی","لا"], audio: "la.wav" },
          { q: "ل + ی = ؟", answer: "لی", choices: ["لے","لو","لی","لا"], audio: "li.wav" },
          { q: "ل + و = ؟", answer: "لو", choices: ["لے","لو","لی","لا"], audio: "lu.wav" },
          { q: "ل + ے = ؟", answer: "لے", choices: ["لے","لو","لی","لا"], audio: "le.wav" },
          { q: "ف + ا = ؟", answer: "فا", choices: ["فے","فو","فی","فا"], audio: "fa.wav" },
          { q: "ف + ی = ؟", answer: "فی", choices: ["فے","فو","فی","فا"], audio: "fi.wav" },
          { q: "ف + و = ؟", answer: "فو", choices: ["فے","فو","فی","فا"], audio: "fu.wav" },
          { q: "ف + ے = ؟", answer: "فے", choices: ["فے","فو","فی","فا"], audio: "fe.wav" },
          { q: "م + ا = ؟", answer: "ما", choices: ["مے","مو","می","ما"], audio: "ma.wav" },
          { q: "م + ی = ؟", answer: "می", choices: ["مے","مو","می","ما"], audio: "mi.wav" },
          { q: "م + و = ؟", answer: "مو", choices: ["مے","مو","می","ما"], audio: "mu.wav" },
          { q: "م + ے = ؟", answer: "مے", choices: ["مے","مو","می","ما"], audio: "me.wav" },
          { q: "گ + و = ؟", answer: "گو", choices: ["گا","گو","گی","گے"], audio: "go.wav" }
        ]
      },
      {
        name: "Level 2 - تین حروف",
        puzzles: [
          { q: "ب + ا + ل = ؟", answer: "بال", choices: ["بال","بار","باز","بام"], audio: "baal.wav" },
          { q: "گ + ھ + ر = ؟", answer: "گھر", choices: ["گھر","گہر","گار","گیر"], audio: "ghar.wav" },
          { q: "ک + ا + م = ؟", answer: "کام", choices: ["کام","کال","کار","کاپ"], audio: "kaam.wav" },
          { q: "پ + ا + ن = ؟", answer: "پان", choices: ["پان","پال","پار","پاک"], audio: "paan.wav" },
          { q: "چ + ا + ر = ؟", answer: "چار", choices: ["چار","چال","چاپ","چاک"], audio: "chaar.wav" },
          { q: "د + و + ر = ؟", answer: "دور", choices: ["دور","دال","دار","داغ"], audio: "door.wav" },
          { q: "ن + ا + م = ؟", answer: "نام", choices: ["نام","نال","نار","ناک"], audio: "naam.wav" },
          { q: "ر + ا + ت = ؟", answer: "رات", choices: ["رات","راز","راہ","رام"], audio: "raat.wav" },
          { q: "د + ا + ل = ؟", answer: "دال", choices: ["دال","دار","دام","داغ"], audio: "daal.wav" },
          { q: "آ + گ = ؟", answer: "آگ", choices: ["آگ","آپ","آم","آج"], audio: "aag.wav" },
          { q: "ب + ا + غ = ؟", answer: "باغ", choices: ["باغ","بار","باز","بام"], audio: "baagh.wav" },
          { q: "م + ا + ں = ؟", answer: "ماں", choices: ["ماں","مان","مال","مار"], audio: "maan.wav" }
        ]
      },
      {
        name: "Level 3 - چار حروف",
        puzzles: [
          { q: "ک + ت + ا + ب = ؟", answer: "کتاب", choices: ["کتاب","کمال","کلام","کمان"], audio: "kitaab.wav" },
          { q: "پ + ا + ن + ی = ؟", answer: "پانی", choices: ["پانی","پالک","پارک","پاکی"], audio: "paani.wav" },
          { q: "آ + د + م + ی = ؟", answer: "آدمی", choices: ["آدمی","آرام","آواز","آنکھ"], audio: "aadmi.wav" },
          { q: "س + ب + ز + ی = ؟", answer: "سبزی", choices: ["سبزی","سردی","سالی","سمجھ"], audio: "sabzi.wav" },
          { q: "م + ک + ا + ن = ؟", answer: "مکان", choices: ["مکان","مہان","ملان","مدان"], audio: "makaan.wav" },
          { q: "د + و + س + ت = ؟", answer: "دوست", choices: ["دوست","درست","دولت","دنیا"], audio: "dost.wav" },
          { q: "پ + ھ + و + ل = ؟", answer: "پھول", choices: ["پھول","پہول","پلول","پکول"], audio: "phool.wav" },
          { q: "چ + ا + ن + د = ؟", answer: "چاند", choices: ["چاند","چالد","چارد","چاکد"], audio: "chaand.wav" },
          { q: "پ + ر + ن + د = ؟", answer: "پرند", choices: ["پرند","پلند","پکند","پہند"], audio: "parind.wav" },
          { q: "س + و + ر + ج = ؟", answer: "سورج", choices: ["سورج","سالج","سارج","سیرج"], audio: "suraj.wav" },
          { q: "م + چ + ھ + ر = ؟", answer: "مچھر", choices: ["مچھر","محھر","ملھر","مکھر"], audio: "machar.wav" },
          { q: "ب + چ + ھ + ا = ؟", answer: "بچھا", choices: ["بچھا","بلھا","بکھا","بہھا"], audio: "bachha.wav" }
        ]
      },
      {
        name: "Level 4 - پانچ حروف",
        puzzles: [
          { q: "ت + ع + ل + ی + م = ؟", answer: "تعلیم", choices: ["تعلیم","تکلیم","تسلیم","تحلیم"], audio: "taleem.wav" },
          { q: "م + ب + ا + ر + ک = ؟", answer: "مبارک", choices: ["مبارک","مابرک","مبراک","مباکر"], audio: "mohabbat.wav" },
          { q: "ا + ن + س + ا + ن = ؟", answer: "انسان", choices: ["انسان","اہسان","امسان","الشان"], audio: "insaan.wav" },
          { q: "م + د + ر + س + ہ = ؟", answer: "مدرسہ", choices: ["مدرسہ","مہرسہ","ملرسہ","مررسہ"], audio: "madrasa.wav" },
          { q: "خ + و + ش + ی = ؟", answer: "خوشی", choices: ["خوشی","خرشی","خیشی","خاشی"], audio: "khushi.wav" },
          { q: "م + ش + ک + ل = ؟", answer: "مشکل", choices: ["مشکل","مہکل","ملکل","مرکل"], audio: "mushkil.wav" },
          { q: "ت + ا + ر + ی + خ = ؟", answer: "تاریخ", choices: ["تاریخ","تہریخ","تیریخ","تاھیخ"], audio: "tareekh.wav" },
          { q: "م + ق + ا + ل + ہ = ؟", answer: "مقالہ", choices: ["مقالہ","مہالہ","میالہ","مرالہ"], audio: "maqala.wav" },
          { q: "ح + ا + ل + ا + ت = ؟", answer: "حالات", choices: ["حالات","ہالات","خالات","جالات"], audio: "haalaat.wav" },
          { q: "م + س + ا + ئ + ل = ؟", answer: "مسائل", choices: ["مسائل","مہائل","میائل","مرائل"], audio: "masail.wav" }
        ]
      },
      {
        name: "Level 5 - چھ حروف",
        puzzles: [
          { q: "ت + ر + ب + ی + ت = ؟", answer: "تربیت", choices: ["تربیت","ترہیت","تریبت","تربیہ"], audio: "tarbiyat.wav" },
          { q: "م + خ + ص + و + ص = ؟", answer: "مخصوص", choices: ["مخصوص","محصوص","ملصوص","مرصوص"], audio: "makhsoos.wav" },
          { q: "ح + ک + و + م + ت = ؟", answer: "حکومت", choices: ["حکومت","حہومت","حلومت","حرومت"], audio: "hukumat.wav" },
          { q: "ت + ج + ر + ب + ہ = ؟", answer: "تجربہ", choices: ["تجربہ","تہربہ","تلربہ","ترربہ"], audio: "tajurba.wav" },
          { q: "م + ع + ا + ش + ر + ہ = ؟", answer: "معاشرہ", choices: ["معاشرہ","مہاشرہ","میاشرہ","مراشرہ"], audio: "muashira.wav" },
          { q: "ا + ح + ت + ر + ا + م = ؟", answer: "احترام", choices: ["احترام","اہترام","ایترام","ارترام"], audio: "ehtram.wav" },
          { q: "م + ق + ص + د + ی + ت = ؟", answer: "مقصدیت", choices: ["مقصدیت","مہصدیت","ملصدیت","مرصدیت"], audio: "maqsadiyat.wav" },
          { q: "آ + ز + ا + د + ی = ؟", answer: "آزادی", choices: ["آزادی","آہادی","آلادی","آرادی"], audio: "azaadi.wav" },
          { q: "م + ہ + ر + ب + ا + ن = ؟", answer: "مہربان", choices: ["مہربان","محربان","ملربان","مرربان"], audio: "mehrbaan.wav" },
          { q: "ا + ن + ت + ظ + ا + ر = ؟", answer: "انتظار", choices: ["انتظار","اہتظار","ایتظار","ارتظار"], audio: "intezaar.wav" }
        ]
      }
    ];

    // ---------- Game state ----------
    let currentLevel = 0;
    let currentPuzzle = 0;
    let score = 0;

    // ---------- UI helpers ----------
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const feedbackEl = document.getElementById('feedback');
    const levelDisplayEl = document.getElementById('level-display');
    const scoreEl = document.getElementById('score');

    function updateLevelButtons() {
      document.querySelectorAll('.level-btn').forEach((btn, idx) => {
        if (idx === currentLevel) btn.classList.add('active'); else btn.classList.remove('active');
      });
    }

    function changeLevel(levelIndex) {
      currentLevel = levelIndex;
      currentPuzzle = 0;
      updateLevelButtons();
      loadPuzzle();
      updateDisplay();
    }

    function updateDisplay() {
      levelDisplayEl.innerText = levels[currentLevel].name;
      scoreEl.innerText = score;
    }

    function loadPuzzle() {
      feedbackEl.style.display = 'none';
      const level = levels[currentLevel];
      if (!level || level.puzzles.length === 0) {
        questionEl.innerText = 'کوئی پزل موجود نہیں';
        optionsEl.innerHTML = '';
        return;
      }
      // ensure currentPuzzle within bounds
      if (currentPuzzle >= level.puzzles.length) currentPuzzle = 0;
      const puzzle = level.puzzles[currentPuzzle];
      questionEl.innerText = puzzle.q || '---';
      optionsEl.innerHTML = '';

      // shuffle choices
      const shuffled = [...puzzle.choices].sort(() => Math.random() - 0.5);
      shuffled.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.innerText = choice;
        btn.setAttribute('role','listitem');
        btn.onclick = () => checkAnswer(choice);
        optionsEl.appendChild(btn);
      });
    }

    function checkAnswer(choice) {
      const puzzle = levels[currentLevel].puzzles[currentPuzzle];
      if (!puzzle) return;
      if (choice === puzzle.answer) {
        // correct: update score, play audio (if file exists), launch fireworks, advance puzzle
        score += (currentLevel + 1) * 20;
        updateDisplay();

        // play audio if provided (silently fail if not found)
        if (puzzle.audio) {
          try {
            const audio = new Audio(puzzle.audio);
            audio.play().catch(()=>{});
          } catch (e) {}
        }

        // launch enhanced fireworks
        launchFireworks();

        // short pause so fireworks visible, then next puzzle
        setTimeout(() => {
          currentPuzzle++;
          if (currentPuzzle >= levels[currentLevel].puzzles.length) currentPuzzle = 0;
          loadPuzzle();
          updateDisplay();
        }, 2000);
      } else {
        // wrong: show feedback message briefly
        feedbackEl.innerText = "❌ دوبارہ کوشش کریں!";
        feedbackEl.style.display = 'block';
        setTimeout(() => {
          feedbackEl.style.display = 'none';
        }, 1500);
      }
    }

    // initialize
    updateLevelButtons();
    updateDisplay();
    loadPuzzle();

    // keyboard accessibility: number keys 1-4 select option in order
    window.addEventListener('keydown', (e) => {
      const opts = Array.from(document.querySelectorAll('.option'));
      if (!opts.length) return;
      if (e.key >= '1' && e.key <= String(opts.length)) {
        const idx = Number(e.key) - 1;
        opts[idx].click();
      }
      // left/right to change levels
      if (e.key === 'ArrowLeft') changeLevel(Math.max(0, currentLevel-1));
      if (e.key === 'ArrowRight') changeLevel(Math.min(levels.length-1, currentLevel+1));
    });

    // Prevent zoom on double tap for better mobile experience
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // Handle orientation change
    window.addEventListener('orientationchange', function() {
      setTimeout(resizeCanvas, 100);
    });

    // Improved touch handling - only for game container area, not level changes
    let gameContainer = document.querySelector('.game-container');
    let touchStartTime = 0;
    let touchStartX = 0;
    let touchStartY = 0;
    let isScrolling = false;

    gameContainer.addEventListener('touchstart', function(e) {
      touchStartTime = Date.now();
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
      isScrolling = false;
    }, { passive: true });

    gameContainer.addEventListener('touchmove', function(e) {
      if (!touchStartX || !touchStartY) return;
      
      let touchEndX = e.touches[0].clientX;
      let touchEndY = e.touches[0].clientY;
      let diffX = Math.abs(touchStartX - touchEndX);
      let diffY = Math.abs(touchStartY - touchEndY);
      
      // If significant vertical movement, consider it scrolling
      if (diffY > 10) {
        isScrolling = true;
      }
    }, { passive: true });

    // Remove swipe functionality to prevent accidental level changes
    gameContainer.addEventListener('touchend', function(e) {
      // Reset values
      touchStartTime = 0;
      touchStartX = 0;
      touchStartY = 0;
      isScrolling = false;
    }, { passive: true });
  </script>
</body>
</html>
